{
  "version": 3,
  "sources": ["../src/extension.ts"],
  "sourcesContent": ["import * as vscode from \"vscode\";\n\nexport function activate(context: vscode.ExtensionContext) {\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand(\"molic.preview\", () => {\n\t\t\tMoLICPanel.createOrShow(context.extensionUri);\n\t\t}),\n\t);\n}\n\nclass MoLICPanel {\n\tpublic static currentPanel: MoLICPanel | undefined;\n\tprivate readonly _panel: vscode.WebviewPanel;\n\tprivate readonly _extensionUri: vscode.Uri;\n\tprivate _updateTimeout: NodeJS.Timeout | undefined;\n\tprivate _disposables: vscode.Disposable[] = [];\n\n\tprivate constructor(panel: vscode.WebviewPanel, extensionUri: vscode.Uri) {\n\t\tthis._panel = panel;\n\t\tthis._extensionUri = extensionUri;\n\n\t\t// Define o HTML uma \u00FAnica vez para estabilizar o Service Worker\n\t\tthis._panel.webview.html = this._getHtmlForWebview(this._panel.webview);\n\n\t\t// Primeira carga: Aguarda a webview estar pronta para receber a mensagem\n\t\tthis._panel.webview.onDidReceiveMessage(\n\t\t\t(message) => {\n\t\t\t\tif (message.command === \"ready\") {\n\t\t\t\t\tthis._update();\n\t\t\t\t}\n\t\t\t},\n\t\t\tnull,\n\t\t\tthis._disposables,\n\t\t);\n\n\t\tthis._panel.onDidDispose(() => this.dispose(), null, this._disposables);\n\n\t\t// Monitora mudan\u00E7as no texto com o Debounce de 300ms\n\t\tvscode.workspace.onDidChangeTextDocument(\n\t\t\t(e) => {\n\t\t\t\tif (e.document === vscode.window.activeTextEditor?.document) {\n\t\t\t\t\tif (this._updateTimeout) {\n\t\t\t\t\t\tclearTimeout(this._updateTimeout);\n\t\t\t\t\t}\n\t\t\t\t\tthis._updateTimeout = setTimeout(() => this._update(), 300);\n\t\t\t\t}\n\t\t\t},\n\t\t\tnull,\n\t\t\tthis._disposables,\n\t\t);\n\n\t\t// Atualiza se o usu\u00E1rio trocar de aba de arquivo\n\t\tvscode.window.onDidChangeActiveTextEditor(\n\t\t\t() => this._update(),\n\t\t\tnull,\n\t\t\tthis._disposables,\n\t\t);\n\t}\n\n\tpublic static createOrShow(extensionUri: vscode.Uri) {\n\t\tconst column = vscode.window.activeTextEditor?.viewColumn;\n\n\t\tif (MoLICPanel.currentPanel) {\n\t\t\tMoLICPanel.currentPanel._panel.reveal(column);\n\t\t\treturn;\n\t\t}\n\n\t\tconst panel = vscode.window.createWebviewPanel(\n\t\t\t\"molicView\",\n\t\t\t\"MoLIC Preview\",\n\t\t\tcolumn || vscode.ViewColumn.Two,\n\t\t\t{\n\t\t\t\tenableScripts: true,\n\t\t\t\tlocalResourceRoots: [vscode.Uri.joinPath(extensionUri, \"dist\")],\n\t\t\t},\n\t\t);\n\n\t\tMoLICPanel.currentPanel = new MoLICPanel(panel, extensionUri);\n\t}\n\n\tprivate _update() {\n\t\tconst editor = vscode.window.activeTextEditor;\n\t\tif (!editor || !this._panel.visible) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Envia o texto para a \"cozinha\" (webview) processar\n\t\tthis._panel.webview.postMessage({\n\t\t\tcommand: \"render\",\n\t\t\ttext: editor.document.getText(),\n\t\t});\n\t}\n\n\tprivate _getHtmlForWebview(webview: vscode.Webview) {\n\t\tconst scriptUri = webview.asWebviewUri(\n\t\t\tvscode.Uri.joinPath(this._extensionUri, \"dist\", \"webview.js\"),\n\t\t);\n\t\tconst nonce = getNonce();\n\n\t\t// CSP ajustada: 'unsafe-inline' \u00E9 necess\u00E1rio para os estilos din\u00E2micos do Mermaid\n\t\treturn `<!DOCTYPE html>\n    <html lang=\"pt-br\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src ${webview.cspSource} https:; script-src 'nonce-${nonce}' 'unsafe-eval'; style-src ${webview.cspSource} 'unsafe-inline';\">\n        <style>\n            body { font-family: sans-serif; padding: 20px; color: var(--vscode-editor-foreground); background-color: var(--vscode-editor-background); overflow: hidden; }\n            #app { width: 100%; height: 100vh; overflow: auto; }\n            svg { max-width: 100%; height: auto; shape-rendering: geometricPrecision; }\n        </style>\n    </head>\n    <body>\n        <div id=\"app\">Aguardando c\u00F3digo MoLIC...</div>\n        <script nonce=\"${nonce}\" src=\"${scriptUri}\"></script>\n    </body>\n    </html>`;\n\t}\n\n\tpublic dispose() {\n\t\tMoLICPanel.currentPanel = undefined;\n\t\tthis._panel.dispose();\n\t\twhile (this._disposables.length) {\n\t\t\tconst x = this._disposables.pop();\n\t\t\tif (x) {\n\t\t\t\tx.dispose();\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction getNonce() {\n\tlet text = \"\";\n\tconst possible =\n\t\t\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\tfor (let i = 0; i < 32; i++) {\n\t\ttext += possible.charAt(Math.floor(Math.random() * possible.length));\n\t}\n\treturn text;\n}\n"],
  "mappings": "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",
  "names": []
}
